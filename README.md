<h1 align="center">Hi ðŸ‘‹, I'm sanjo Varghese</h1>
<h3 align="center">A passionate IT proffesional</h3>

- ðŸŒ± Iâ€™m currently learning **Python**

- ðŸ’¬ Ask me about **Cloud,Cyber security,System**

- ðŸ“« How to reach me **sanjovarghese484@gmail.com**

- âš¡ Fun fact **Iam a Noob**

<h3 align="left">Connect with me:</h3>
<p align="left">
<a href="https://linkedin.com/in/sanjo-varghese-18a016269" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/linked-in-alt.svg" alt="sanjo-varghese-18a016269" height="30" width="40" /></a>
<a href="https://fb.com/sanjovarghese.net" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/facebook.svg" alt="sanjovarghese.net" height="30" width="40" /></a>
<a href="https://instagram.com/sanjo._.varghese" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/instagram.svg" alt="sanjo._.varghese" height="30" width="40" /></a>
</p>

<h3 align="left">Languages and Tools:</h3>
<p align="left"> <a href="https://www.arduino.cc/" target="_blank" rel="noreferrer"> <img src="https://cdn.worldvectorlogo.com/logos/arduino-1.svg" alt="arduino" width="40" height="40"/> </a> <a href="https://aws.amazon.com" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/amazonwebservices/amazonwebservices-original-wordmark.svg" alt="aws" width="40" height="40"/> </a> <a href="https://azure.microsoft.com/en-in/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/microsoft_azure/microsoft_azure-icon.svg" alt="azure" width="40" height="40"/> </a> <a href="https://www.cprogramming.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/c/c-original.svg" alt="c" width="40" height="40"/> </a> <a href="https://www.w3schools.com/cpp/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/cplusplus/cplusplus-original.svg" alt="cplusplus" width="40" height="40"/> </a> <a href="https://www.docker.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/docker/docker-original-wordmark.svg" alt="docker" width="40" height="40"/> </a> <a href="https://dotnet.microsoft.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/dot-net/dot-net-original-wordmark.svg" alt="dotnet" width="40" height="40"/> </a> <a href="https://cloud.google.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/google_cloud/google_cloud-icon.svg" alt="gcp" width="40" height="40"/> </a> <a href="https://git-scm.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/git-scm/git-scm-icon.svg" alt="git" width="40" height="40"/> </a> <a href="https://grafana.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/grafana/grafana-icon.svg" alt="grafana" width="40" height="40"/> </a> <a href="https://www.w3.org/html/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/html5/html5-original-wordmark.svg" alt="html5" width="40" height="40"/> </a> <a href="https://www.adobe.com/in/products/illustrator.html" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/adobe_illustrator/adobe_illustrator-icon.svg" alt="illustrator" width="40" height="40"/> </a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/javascript/javascript-original.svg" alt="javascript" width="40" height="40"/> </a> <a href="https://www.jenkins.io" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/jenkins/jenkins-icon.svg" alt="jenkins" width="40" height="40"/> </a> <a href="https://kubernetes.io" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/kubernetes/kubernetes-icon.svg" alt="kubernetes" width="40" height="40"/> </a> <a href="https://www.linux.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/linux/linux-original.svg" alt="linux" width="40" height="40"/> </a> <a href="https://www.mongodb.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/mongodb/mongodb-original-wordmark.svg" alt="mongodb" width="40" height="40"/> </a> <a href="https://www.photoshop.com/en" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/photoshop/photoshop-line.svg" alt="photoshop" width="40" height="40"/> </a> <a href="https://www.python.org" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" alt="python" width="40" height="40"/> </a> <a href="https://reactjs.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/react/react-original-wordmark.svg" alt="react" width="40" height="40"/> </a> <a href="https://www.vagrantup.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/vagrantup/vagrantup-icon.svg" alt="vagrant" width="40" height="40"/> </a> </p>


# Build and Deploy a Modern YouTube Clone Application in React JS with Material UI 5
 # Architecture
![gitlab](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/1d149f85-0c80-48d8-8b62-e18552b371f1)


![YouTube](https://i.ibb.co/4R5RkmW/Thumbnail-5.png)

### Showcase your dev skills with practical experience and land the coding career of your dreams
ðŸ’» JS Mastery Pro - https://jsmastery.pro/youtube
âœ… A special YOUTUBE discount code is automatically applied!

ðŸ“™ Get the Ultimate Frontend & Backend Development Roadmaps, a Complete JavaScript Cheatsheet, Portfolio Tips, and more - https://www.jsmastery.pro/links

# Procedure
- Step 1: Create an API key for Youtube.
- Step 2: Create a Repository and push it to GitLab.
- Step 3: Launch an Ec2 instance and run Sonarqube on it.
- Step 4A: Create a .gitlab-ci.yml File.
- Step 4B: Add the required variables for the project.
- Step 5: Install Gitlab Runner on Ec2.
- Step 6: Run the Application on the Docker container.
- Step 7: Access the Application on Browser.
# Step 1: Create an API key from Rapid API
- Open a new tab in the browser and search for rapidapi.com
- It will automatically provide your mail and select a mail to create an account


![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5e78cde7-76ff-465e-b42a-2132e88e467f)


**Account is created**
- Now in the search bar search for YouTube and select YouTube v3

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/8bcbc23f-b02a-4d42-b255-5c2398e5c3c1)
**Copy API and save it for further use at the docker stage.**
- docker build --build-arg REACT_APP_RAPID_API_KEY=<API-KEY> -t ${imageName} .

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/e651a0c5-f692-4b51-9224-40c927781cd3)



# Step 2: Create a Repository and push it to GitLab
Go to GitLab.com and login to your account
- Click on New Project
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/efb323a1-734a-4207-a7a7-6f8ff7dab46d)

Click on Create Blank Project
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/6ca9501f-78c8-4e3a-987f-0c62bd9d68b8)


- Provide a name for the Project
- Keep Visibility to the public
Uncheck the Readme and create the Project.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5ec5d89d-66ef-4b7b-94e9-bb546dac807f)


Use the below commands to push code to GitLab
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/1a067416-23a8-4a87-ad01-8219b21a291e)

Files pushed to GitLab.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/0c417112-7818-4b01-9873-5e4be5dc9df3)


# Step 3: Launch an Ec2 instance and run Sonarqube on it

**Log into AWS Console**: Sign in to your AWS account.
**Launch an Instance:**
Choose **"EC2"** from services. Click "Launch Instance."
**Choose an AMI:** Select an Ubuntu image.
Choose an Instance Type: Pick **"t2.medium."**
**Key Pair:** Choose an existing key pair or create a new one.
**Configure Security Group:**
Create a new security group. Add rules for **HTTP, and HTTPS,** and open all ports for learning purposes. Add Storage: Allocate at least 10 GB of storage.
**Launch Instance:** Review and launch the instance.
Access Your Instance: Use SSH to connect to your instance with the private key.
Keep in mind, that opening all ports is not recommended for production environments; it's just for educational purposes.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/b096d9d1-f2b7-4e1e-ad3e-690471121ac6)


# Connect to Your EC2 Instance and install docker:
Run the below commands to install the docker
**COPY Commands:**
```sh 
sudo apt-get update
sudo apt-get install docker.io -y
sudo usermod -aG docker $USER   #my case is ubuntu
newgrp docker
sudo chmod 777 /var/run/docker.sock
```
After the docker installation, we will create a Sonarqube container (Remember to add 9000 ports in the security group).
Run this command on your EC2 instance to create a SonarQube container:
**copy**
```sh 
docker run -d --name sonar -p 9000:9000 sonarqube:lts-community
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/4ec10b2a-590b-4a9f-b6a5-127230c23210)

Now copy the IP address of the ec2 instance
```sh
<ec2-public-ip:9000>
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/bbb9bb5d-0897-4849-8c47-30088a709c5e)

Enter username and password, click on login and change password

```sh
username admin
password admin
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/7a76f0de-6326-4b44-b9b3-3968eb80559e)


Update New password, This is Sonar Dashboard.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/7a25fe1d-155a-4d11-8af0-3dd12d72bf7c)


**Step 4A:** Create a **.gitlab-ci.yml** File.
Now go to GitLab click on '+' and click on Newfile
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/a35ce19b-b968-431a-99b9-569c9e0453ba)

File name .gitlab-ci.yml
Content

```sh
stages:
    - npm

Install dependecy:
    stage: npm    
    image:
        name: node:16
    script:
        - npm install
```

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5f40ad99-576a-4661-b66d-acef4c9adc69)


Commit the changes and it will automatically start the build
- Now click on Build and Pipelines

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/9773163b-34d2-45a9-b71a-7c3e7dad5699)


- Now click on Running.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/31910a0f-3990-4386-b7ee-be733dd09f36)

- Click on Install dependency
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/b730603c-a97a-4cfd-b32b-ff83f4e6503d)

- You will build output
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/db2a7d36-a03f-4754-aba3-420c70bec3fe)

- Now add the Sonarqube stage to the pipeline
- Go to the Sonarqube dashboard and click on Manually.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/497c6739-9b9d-4d4c-8911-a1b538afb8c3)

- Provide the name of the Project and click on Setup.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/d1018987-dc72-490e-910a-74042006f780)
- Select the CI tool as GitLab CI.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/2f5cbf03-493c-47ee-90c1-e3ebbd17e959)


- Select Other because we are using the JS App
- It will provide code and we need to create a file inside our repo
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/7f3e516e-fc18-4301-9e37-cec76d099e69)

- Go to Gitlab and click on + and Newfile.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/334fc64d-6e8b-4e31-afa1-efea63a00e29)

- Filename is sonar-project.properties
- Paste the content that you got from Sonarqube
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/3176ac6c-670d-4c95-94f0-a0dd0eeb086e)

- The file looks like this and click on commit changes
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/7706320d-2df9-4853-b0b3-ee4f53aae943)

- Go to Sonarqube and click on continue.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/9d917ebd-896c-4846-a0c0-05f81274a19f)

- Now it will provide Variables to add to our GitLab.
# Step 4B: Add the required variables for the project.
**Variables Generated**
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/c80354a1-6ee1-47d1-aab5-1c150dcae125)

- Now go to GitLab
- Click on settings and CI/CD
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/e15e8d93-0b77-445e-9443-3e2bf0cb6763)

- Click on Expand in variables
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/6cef499c-371b-4e2b-a4eb-b67d68296e91)

- Click on Add variable
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/543e106b-d698-401d-adc9-e41d275c4f01)

- Now go back to Sonarqube and copy the Key
- Click on Generate a token
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/f177701b-ccaa-4c55-8547-34e9443220b7)

- Again Click on Generate
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/f856e28d-f98d-4f9b-8eb3-1b933486673c)

- Copy the token.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/2cf64211-516d-41d7-ae98-3dd9d588c5d2)

- Now come back to GitLab and add them like the below image and click on add variable.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/f152003a-49f9-406f-9ea3-296647a1cbf2)

- Sonar token is added
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/45978940-5c8a-489f-ac47-eff5acd1320f)

- Now go to the Sonarqube Dashboard again
- Let's add another variable, copy them
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/257b798f-fed9-4996-bf7c-fc5f9224866c)

- Now go to GitLab and click on Add variable
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5b2e6d00-72d2-404a-a4c8-f33c3435a81f)

- Add the copied values like the below image
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/81bac4aa-52e4-43f7-ba0d-75f3b8a77359)

- Two variables were added.
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/15585d7a-6d8d-486a-962e-9a53fe7d24ef)


- Now go back to the Sonarqube Dashboard
- Click on continue
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/bbd1379f-5c23-4983-826b-1771e260ea3a)

- It will provide and CI configuration file copy it and use it inside our **.gitlab-ci.yml file**
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/53a2888e-66de-44b8-ba6c-ef34d6ca5b57)

- Now go back to GitLab and edit the .gitlab-ci.yml file
- Full file (update with your content)

```sh
stages:
    - npm
    - sonar

Install dependecy:
    stage: npm    
    image:
        name: node:16
    script:
        - npm install    

sonarqube-check:
  stage: sonar
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner
  allow_failure: true
  only:
    - main
```

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/b7df251e-4b40-457f-bb20-6d083a0f966c)

- Commit changes and it will automatically start the build.
- Click on Build --> Pipelines
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/4ca219b4-dcbe-43fb-b04b-109c8ab44a37)

- Click on Running
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/27bf464a-6d04-4d4f-a968-4611b351e0f4)

- Now click on Sonarqube-check
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/54010150-9287-43ff-8974-52ceee49ecf4)

- Build output
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/0682db8d-bf4b-4fab-9c35-24632f95d0cd)


- Now add the next stage of the **Trivy file scan**
- Update the **.gitlab-ci.yml** file

```sh
stages:
    - npm
    - sonar
    - trivy file scan

Install dependecy:
    stage: npm    
    image:
        name: node:16
    script:
        - npm install    

sonarqube-check:
  stage: sonar
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner
  allow_failure: true
  only:
    - main

Trivy file scan:
  stage: trivy file scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy fs .
```
    
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/72161e6b-be16-4c26-8348-b12ff8a83557)


- Commit changes and go to pipeline stages
- Click on the **Trivy file scan**
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/48b513be-7d9d-4a5c-928d-188ed6288910)


- Build output
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/722a7310-88fe-4b00-89fd-182a25c21007)


- Add the Docker build and push stage
- Before that Add docker credentials to GitLab Variables as secrets.
- Go to the docker hub and create a Personal Access token
- Click on your profile name and Account Settings
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/2aadafa8-c98e-4a1b-a255-917d376e0628)

- Now click on Security --> New Access Token
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5fef05bc-e5e7-4219-8d0c-b760bf3a777e)


- Provide a name --> Generate
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/baafd730-86ec-4491-b677-cfabd3422004)


- Now copy the token and keep it safe
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/8fe6051c-e0bf-45eb-aa14-63c3c4a2982d)


- Now go back to Gitlab
- Click on settings and CI/CD
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/66dc7615-fab3-4957-953f-1532c2ede036)

- Click on Expand in variables
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/de5c7805-7b31-4f56-9651-2b85ef52a62a)

- Click on Add variable
- Use your DockerHub username in value and Add variable
- Key DOCKER_USERNAME
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/939ea818-87f2-49ae-bb8d-5b1f75cc3a01)

- Click on Add variable again
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/cfca5f80-5e62-4d5a-bb7d-3395f92b4f4a)


- Key DOCKER_PASSWORD
- For value use the Generated Personal Access token and add a variable.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/4e4a97e3-5ba0-4978-9f7a-4b9dca9224cc)

- Variables added.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/abd36556-9055-4a2f-a169-44bd63b3373d)

- Now add the below stage to the Configuration .gitlab-ci.yml file
- Added Docker and Trivy image scan stages

```sh
stages:
    - npm
    - sonar
    - trivy file scan
    - docker
    - trivy image scan

Install dependecy:
    stage: npm    
    image:
        name: node:16
    script:
        - npm install    

sonarqube-check:
  stage: sonar
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner
  allow_failure: true
  only:
    - main

Trivy file scan:
  stage: trivy file scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy fs . 

Docker build and push:
  stage: docker
  image:
    name: docker:latest
  services:
    - docker:dind   
  script:
    - docker build --build-arg REACT_APP_RAPID_API_KEY=f0ead79813mshb0aa7ddf114a7dap1adb3djsn483b017de1a9 -t youtubev1 .    
    - docker tag youtubev1 sevenajay/youtubev1:latest
    - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
    - docker push sevenajay/youtubev1:latest

Scan image:
  stage: trivy image scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy image sanjovarghese/youtubev1:latest
```
- Added stages
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/1dbeef45-5338-4f68-95d6-c0c49af64d13)

- Commit changes and it will automatically start building.
- Go to Pipelines view
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/24efaa4f-1e53-4b0d-8301-275bf8929d35)

- Now click on Docker build and push
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/03bff29c-6765-442b-a156-faa5196c5aff)

- Build view
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/cd46c3b0-eb14-4b85-a999-6e8fe7d31271)

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/8a566070-876e-4955-a8fd-add500081fa6)

**Go to Dockerhub and see the image**

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/aabe22b3-893e-4399-b06b-fc77e52fdba8)

- Now come back to GitLab and click on Trivy image scan
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/3d890943-2dee-426f-9e87-51e420279ecf)

- Output raw
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/1914fe6f-0049-45ed-b765-1d96cff11481)

# Step 5: Install Gitlab Runner on Ec2
- Go to GitLab and Click on Settings and CI/CD
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/24965743-6c47-4c0e-b66f-d712195dcf75)


- Click on Expand at Runners.
 ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/e7b59ea4-f3c5-4ba6-8c66-2a4b124bb533)

  - Click on Three dots and then click on Show Runner installation.
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/43df3419-a4da-4137-a7dc-62f3e3fd37ba)

- Click on Linux and amd64 and copy the commands
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/47e236c7-d084-4baf-880c-9230f929658b)


- Now come back to Putty or Mobaxtreme
- Create a new file
```sh
sudo vi gitlab-runner-installation
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/7a23d1b8-0aa8-45f9-a191-04179df38929)

- Paste the below commands into it
# Download the binary for your system
```sh
sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
```

# Give it permission to execute
```sh
sudo chmod +x /usr/local/bin/gitlab-runner
```
# Create a GitLab Runner user
```sh
sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
```
# Install and run as a service
```sh
sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
sudo gitlab-runner start
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/cd8df765-422d-4942-a8a1-ab2f5385cd14)

- Provide executable permissions and run the script
```sh
sudo chmod +x <file-name>
./<file-name>
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/38837c42-91d4-484c-8b66-ab7885e444ed)

- Installation completed
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/e99d9d71-ceb3-4015-8305-5908b7d86831)

- Start the GitLab runner
```sh
sudo gitlab-runner start
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/a7948d6e-e0e6-4f04-b69c-03b634713aa4)

- Now run the below command or your command to register the runner
- Update the token is enough
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/c95c8fc9-45db-441c-a979-f6eaafb686a1)


```sh
sudo gitlab-runner register --url https://gitlab.com/ --registration-token <token>
```
**Provide the details for registering the runner**
- 1.	Provide Enter for GitLab.com
- 2.	For token we already added with token, so click on Enter again
- 3.	Description as your wish
- 4.	Tags also and you can use multiple tags by providing a comma after each tga
- 5.	Maintenance note is just optional
- 6.	For executors use Shell
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/9e22768c-688c-41b3-8a2c-48a32eedf7c7)

- Runner added successfully.
- Start the GitLab runner

```sh
sudo gitlab-runner start
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/960fd7ba-9fc8-4cc9-b354-98eb8f8d3e16)


- Run the GitLab runner
```sh
sudo gitlab-runner run
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/007c416e-82fa-4ce0-af5b-c7461db3049d)

- Go to GitLab and refresh the page once or click on Enable for this project
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/515ed40b-532e-4914-99fa-9f9a9d08846d)

- Now the runner is active and waiting for jobs
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/42087bd6-8bcd-406a-893f-5f4440ded1ee)

- Click on the Pencil mark to edit
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/dbb1bb40-2846-46bc-95a1-0ac305c467fe)

- Click on the Check box to indicate whether this runner can pick jobs without tags.
  ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/9270b768-6464-449f-8776-ccb664567d71)

- Click on save changes.
# Step 6: Run the Application on the Docker container
- Now edit the **.gitlab-ci.yml**file for the deploy stage
- The complete file

 ```sh
  stages:
    - npm
    - sonar
    - trivy file scan
    - docker
    - trivy image scan
    - run container
Install dependecy:
    stage: npm    
    image:
        name: node:16
    script:
        - npm install    
sonarqube-check:
  stage: sonar
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner
  allow_failure: true
  only:
    - main
Trivy file scan:
  stage: trivy file scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy fs . 
Docker build and push:
  stage: docker
  image:
    name: docker:latest
  services:
    - docker:dind   
  script:
    - docker build --build-arg REACT_APP_RAPID_API_KEY=f0ead79813mshb0aa7ddf114a7dap1adb3djsn483b017de1a9 -t youtubev1 .    
    - docker tag youtubev1 sanjovarghese/youtubev1:latest
    - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
    - docker push sanjovarghese/youtubev1:latest
Scan image:
  stage: trivy image scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy image sanjovarghese/youtubev1:latest
deploy:
  stage: run container
  tags:
    - youtube        #use your own tags 
  script:
    - docker run -d --name youtube -p 3000:3000 sanjovarghese/youtubev1:latest
```

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/93b28545-f7b1-4ca8-b6ad-4a0fa2086e84)


- Commit changes, it will automatically start to build
- Click on Build --> Pipelines
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/a87fcebc-17c0-46b1-888b-512394539259)


- Click on Running
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/6a49e1b9-894e-474f-812f-e1d93b4e0df7)

- The last stage is added to the Pipeline
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/3d26ffa0-d45f-4bea-a91c-d26a9a3b5cb5)

- If you get an error like this
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/271eecf3-4b85-4fba-96e7-8e014dc0b979)

- Go to GitLab and click on deploy job
- Let's see what is the error
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5d3bdf0f-1bd9-42d0-b941-b027d5f4dafe)

- If you get an error like this, click on that link
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/d821ddd3-72a7-4bf9-ada0-5e0573b2d597)

- It will open a new tab and provide a solution for that
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/5bd15164-ffa4-40cf-8dcd-69beeb2b6467)


- Now go to Mobaxtreme and stop the Runner
- Go to root and use the below commands
```sh
sudo su
sudo vi /home/gitlab-runner/.bash_logout
```
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/18147447-53f8-4cfe-8828-55c89be0c3b2)


- You will see file like this
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/b22d1c22-4bc2-47e1-a28e-62afc5430be9)

- Comment them
 ![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/3cbc6106-184d-4eae-91d2-38b504db2f72)

- Save and exit from that file and restart GitLab runner
```sh
sudo gitlab-runner restart
```
exit #from root
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/c2c89d0c-95db-45a4-a00b-99f1fc71139e)


- Now start and Run the GitLab runner
```sh
sudo gitlab-runner start
sudo gitlab-runner run
```

![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/70f484f8-d1a5-4888-9f34-2cdf0df5ac91)

- Now go to GitLab --> Build --> Pipelines
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/c4745183-fd20-49ed-a010-8c11c7aea91f)

- Click on Run Pipeline
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/4ab75a89-9340-4ec8-8e7d-349619ebdce5)

- Again Click on Run Pipeline
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/991f6cd7-0f29-42b9-be0d-41824783f939)

- Build completed and click on Deploy job
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/9aae772e-b38a-4633-83d0-0dab641b573e)


- See the output it ran a container on ec2
![image](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/a85afefb-b6fc-4976-b106-5fda308f5a20)

- Now go to MobaXtreme or Putty and Provide the below command to see running containers.
  
```sh
docker ps
```
- Container running.

# Step 7: Access the Application on Browser
- Copy the Public IP of the ec2 instance and paste it into the Browser.
- Don't forget to open the 3000 port in the Security Group
```sh
<Public-ip:3000>
```
![ttyyy](https://github.com/Sanjo-varghese/DevSecOps-Youtube/assets/116708794/912320cb-4cce-4021-84af-f5ee0a41dac5)


# Step 8: Termination
- 1.	Delete the personal Access token of the docker.
- 2.	Delete the containers.
  ```sh
   docker stop <container name>
   docker rm <container name>
  ```
  # Delete the Ec2 instance.

# Thanks 
























